# Test if the miner screen session is present, switch to it if is.
mnr_screen() {
    local em_screen=$(screen -ls | grep ethminer | awk {'print $1'})
    [ -z ${em_screen} ] || screen -D -R
}

# Start the miner in its screen session
mnr_up() {
    set -u
    ~/bin/automine/${RIG_TYPE}/launch_screen_session.sh
    set +u
}

# Shutdown the miner and its screen session
mnr_down() {
    echo "Shutting down the miner"
    killall -TERM ethminer >/dev/null 2>&1
    kill -TERM `screen -list | grep ethminer | cut -d \. -f 1 | awk {'print $1'}` >/dev/null 2>&1
}

# List the Nvidia PCI bus devices
mnr_nvidia_devices() {
    lspci -vvv | grep -A 20 NVIDIA
}

mnr_nvinfo_mini() {
    nvidia-smi --query-gpu=index,name,pci.sub_device_id --format=csv
}

mnr_nvinfo_lots() {
    nvidia-smi --query-gpu=index,name,pci.sub_device_id,clocks.max.sm,clocks.sm,clocks.max.mem,clocks.mem,power.limit,power.draw,power.min_limit,power.max_limit --format=csv
}

mnr_overclock_info() {
   cat ~/bin/automine/overclock.json
}

mnr_node_cfg() {
   cat ~/bin/automine/cfg.sh
}

# Ensure that the alert directory is present
export AUTOMINE_ALERT_DIR=$HOME/var/automine/triggers
mkdir -p $AUTOMINE_ALERT_DIR
